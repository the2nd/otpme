.TH OTPME-TOOL 1 "2025-12-29" "OTPme 0.3.0a120" "OTPme Manual"
.SH NAME
otpme-tool \- OTPme utility commands
.SH SYNOPSIS
.B otpme-tool
.I command
[\fIoptions\fR]
.SH DESCRIPTION
.B otpme-tool
provides various utility commands for the OTPme system including realm join/leave, login/logout, synchronization, cryptographic operations, backup/restore and more.
.SH COMMANDS
.SS Realm
.TP
.B join \fR[\fIoptions\fR] [\fIdomain\fR]
Join OTPme realm.
.TP
.B leave \fR[\fIoptions\fR] [\fIdomain\fR]
Leave OTPme realm.
.TP
.B get_realm
Show realm of this host.
.TP
.B get_site
Show site of this host.
.TP
.B get_user_site
Get site of login user.
.SS Session
.TP
.B login \fR[\fB\-\-node\fR \fInode\fR] [\fIusername\fR]
Login to OTPme realm.
.TP
.B logout
Logout from OTPme realm.
.TP
.B whoami
Show currently logged in user.
.TP
.B show_sessions
Get otpme-agent login sessions.
.TP
.B get_login_session_id
Get otpme-agent login session ID.
.TP
.B get_login_token
Show token of currently logged in user.
.TP
.B get_login_pass_type
Show token password type used at login.
.TP
.B get_tty
Get TTY for logged in user.
.TP
.B get_sotp \fR[\fB\-\-site\fR \fIsite\fR]
Get a SOTP for logged in user.
.TP
.B get_srp
Get a SRP for logged in user.
.TP
.B get_jwt \fIchallenge\fR
Request JWT from mgmtd.
.TP
.B reneg
Try to renegotiate login session.
.TP
.B reset_reauth
Reset auth_on_action reauth.
.SS Synchronization
.TP
.B sync \fR[\fB\-\-realm\fR \fIrealm\fR] [\fB\-\-site\fR \fIsite\fR] [\fIsync_type\fR]
Tell OTPme daemon to start sync with master node. Sync types: sites, objects, token_data, ssh_authorized_keys, nsscache.
.TP
.B resync \fR[\fB\-\-realm\fR \fIrealm\fR] [\fB\-\-site\fR \fIsite\fR] \fIsync_type\fR
Tell OTPme daemon to start resync the given data type.
.TP
.B sync_status
Get time of last successful sync.
.TP
.B do_sync \fR[\fIoptions\fR] \fIsync_type\fR
Do a manual hostd sync. Sync types: objects, token_counters, used_otps, nsscache, ssh_authorized_keys.
.SS Cryptographic Operations
.TP
.B sign \fR[\fB\-\-stdin\-pass\fR] \fIfile\fR \fIsign_file\fR
Create signature for given file using users RSA key.
.TP
.B verify \fIsign_file\fR \fIfile\fR
Verify signature for given file using users RSA key.
.TP
.B encrypt \fR[\fIoptions\fR] \fIfile\fR \fIoutfile\fR
Encrypt file using users RSA key (AES encryption).
.TP
.B decrypt \fR[\fB\-\-pass\fR \fIpassword\fR] [\fB\-\-stdin\-pass\fR] \fIfile\fR \fIoutfile\fR
Decrypt file using users RSA key.
.SS OTP and MSCHAP Generation
.TP
.B gen_motp \fIepoch_time\fR \fIsecret\fR \fIpin\fR [\fIotp_count\fR]
Generate mOTP OTPs from epoch time, secret and pin.
.TP
.B gen_mschap \fIusername\fR \fIpassword\fR
Generate MSCHAP challenge/response from given username and password.
.TP
.B gen_refresh \fIusername\fR \fIpassword\fR
Generate SRP (Session-Refresh-Password) from given password.
.TP
.B gen_refresh_mschap \fIusername\fR \fIpassword\fR
Generate SRP challenge/response (MSCHAP) from given username and password.
.TP
.B gen_logout \fIusername\fR \fIpassword\fR
Generate SLP (Session-Logout-Password) from given password.
.TP
.B gen_logout_mschap \fIusername\fR \fIpassword\fR
Generate MSCHAP SLP challenge/response from given username and password.
.SS Signer Management
.TP
.B add_signer \fR[\fB\-\-private\fR] [\fB\-\-no\-pin\fR] [\fB\-\-tag\fR \fItag\fR] \fB\-\-signer\-type\fR \fItype\fR \fIobject_id\fR
Add signer.
.TP
.B del_signer \fR[\fB\-\-private\fR] \fIsigner_uuid\fR
Delete signer.
.TP
.B enable_signer \fR[\fB\-\-private\fR] [\fB\-\-type\fR \fIsigner_type\fR] \fIsigner_uuid\fR
Enable signer.
.TP
.B disable_signer \fR[\fB\-\-private\fR] [\fB\-\-type\fR \fIsigner_type\fR] \fIsigner_uuid\fR
Disable signer.
.TP
.B update_signer \fR[\fB\-\-private\fR] [\fB\-\-no\-pin\fR] [\fIsigner_uuid\fR]
Update signer.
.TP
.B show_signer \fR[\fB\-\-private\fR] [\fIsigner_uuid\fR]
Show signer(s).
.SS Offline Token
.TP
.B show_offline_token \fR[\fItoken_id\fR]
Show cached offline token(s).
.TP
.B pin_offline_token
Pin cached offline token(s).
.TP
.B unpin_offline_token
Unpin cached offline token(s).
.SS Object Management
.TP
.B dump \fIcache_type\fR [\fIobject_id\fR]
Tell OTPme daemon to dump the given cache.
.TP
.B dump_object \fIobject_id\fR
Dump object.
.TP
.B dump_index \fR[\fIobject_id\fR]
Dump object index.
.TP
.B delete_object \fIobject_id\fR
Delete object.
.TP
.B check_duplicate_ids \fIobject_type\fR
Check for duplicate uidNumber/gidNumber.
.TP
.B search \fIattribute=\fR\fIvalue\fR \fIobject_type=\fR\fItype\fR \fR[\fIreturn_type=\fR\fIuuid|full_oid|read_oid|name\fR]
Search OTPme objects.
.SS Import
.TP
.B import \fR[\fB\-\-password\fR \fIpassword\fR] \fIfile\fR
Import object config.
.TP
.B add_user \fIfile\fR
Create users listed in file.
.TP
.B mass_object_add \fR[\fB\-\-verify\-only\fR] [\fB\-\-procs\fR \fIN\fR] \fIcsv_file\fR
Add objects from CSV file.
.SS Service Management
.TP
.B reload
Tell OTPme to reload its config.
.TP
.B index \fIcommand\fR
Execute index command (start, status, stop, cli, init, drop, rebuild, create_db_indices, drop_db_indices).
.TP
.B cache \fIcommand\fR
Execute cache command.
.TP
.B radius \fIcommand\fR
Execute radius command (start, status, stop, reload, restart, test).
.SS Key and Certificate
.TP
.B regen_master_key
Regen AES master key.
.TP
.B renew_auth_key
Renew host auth key.
.TP
.B renew_cert
Renew host certificate.
.SS SSH Agent
.TP
.B start_ssh_agent
Start users SSH agent script.
.TP
.B stop_ssh_agent
Stop users SSH agent script.
.TP
.B restart_ssh_agent
Restart users SSH agent script.
.TP
.B ssh_agent_status
Get users SSH agent script status.
.SS Backup and Restore
.TP
.B backup \fB\-d\fR \fIbackup_dir\fR \fR[\fB\-\-remove\-older\-than\fR \fItime\fR] [\fB\-\-dry\-run\fR]
Write backup to backup directory.
.TP
.B restore \fR{\fB\-d\fR \fIrestore_dir\fR | \fB\-f\fR \fIrestore_file\fR}
Restore from backup.
.SS Benchmark
.TP
.B login_benchmark \fR[\fB\-\-procs\fR \fIN\fR] [\fB\-\-node\fR \fInode\fR] \fIcsv_file\fR
Run login benchmark.
.SS Smartcard
.TP
.B detect_smartcard \fR[\fB\-t\fR \fItype1,type2\fR]
Detect connected smartcards.
.SH OPTIONS
.SS Join Options
.TP
.B \-\-jotp \fIJOTP\fR
Join using the given JOTP.
.TP
.B \-\-host\-type \fInode|host\fR
Join host as type.
.TP
.B \-\-unit \fIUNIT\fR
Join host to the given unit.
.TP
.B \-\-host\-key\-len \fILENGTH\fR
Host/Node key length.
.TP
.B \-\-site\-key\-len \fILENGTH\fR
Site key length.
.TP
.B \-\-trust\-site\-cert
Trust any site certificate.
.TP
.B \-\-check\-site\-cert \fIFINGERPRINT\fR
Check the site certificate fingerprint.
.TP
.B \-\-no\-daemon\-start
Don't start OTPme daemons after joining realm.
.SS Leave Options
.TP
.B \-\-lotp \fILOTP\fR
Leave using the given LOTP.
.TP
.B \-\-offline
Leave realm without talking to OTPme servers.
.TP
.B \-\-keep\-host
Do not delete node/host object on server side.
.TP
.B \-\-no\-keep\-host
Delete node/host object on server side.
.TP
.B \-\-keep\-data
Keep all data (realm data, certs, offline tokens).
.TP
.B \-\-keep\-cache
Keep cached data (offline tokens, nsscache etc.).
.TP
.B \-\-keep\-cert
Do not revoke host certificate when leaving.
.TP
.B \-\-keep\-auth\-key
Do not revoke host auth key when leaving.
.SS Encrypt Options
.TP
.B \-\-rsa
Encrypt file using RSA encryption.
.TP
.B \-\-no\-rsa
Disable use of RSA public keys for encryption of AES keys.
.TP
.B \-u \fIUSERNAME\fR
Encrypt file with public key of given user.
.TP
.B \-\-pass \fIPASSWORD\fR
Use password to encrypt/decrypt the file (AES only).
.TP
.B \-\-stdin\-pass
Read password/passphrase from stdin.
.TP
.B \-\-force\-pass
Force encryption with password (AES only).
.SS Do_sync Options
.TP
.B \-\-realm \fIREALM\fR
Realm to sync.
.TP
.B \-\-site \fISITE\fR
Site to sync.
.TP
.B \-\-resync
Do a complete resync.
.TP
.B \-\-offline
Sync offline token data.
.TP
.B \-\-no\-memory\-cache
Do not cache objects in memory.
.TP
.B \-\-sync\-older\-objects
Sync objects even if they are older than the local ones.
.TP
.B \-\-ignore\-changed\-objects
Sync objects even if they changed while syncing.
.SS Signer Options
.TP
.B \-\-private
Operate on signer of the logged in user.
.TP
.B \-\-no\-pin
Do not pin signature keys.
.TP
.B \-\-signer\-type \fITYPE\fR
Signer type.
.TP
.B \-\-tag \fITAG\fR
Add tag to signer (can be used multiple times).
.PP
Global options are available for all commands. See
.BR otpme (1)
for details.
.SH EXAMPLES
.TP
.B otpme-tool join \-\-jotp abc123 example.com
Join OTPme realm
.TP
.B otpme-tool login alice
Login as user alice
.TP
.B otpme-tool sync objects
Start object sync
.TP
.B otpme-tool backup \-d /backup/otpme
Create backup
.TP
.B otpme-tool detect_smartcard
Detect connected smartcards
.SH FILES
.TP
.I /var/lib/otpme/
OTPme data directory
.SH SEE ALSO
.BR otpme (1),
.BR otpme (7)

.SH AUTHOR
the2nd <the2nd@otpme.org>
.SH NOTE
This manual page was created with AI assistance.
.SH COPYRIGHT
Copyright \(co 2014-2025 the2nd. License: GPLv3
